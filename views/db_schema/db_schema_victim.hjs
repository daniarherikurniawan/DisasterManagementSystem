<!DOCTYPE html>
<html>
	<head>
		<title>DIMAS</title>
		<link href="../../stylesheets/bootstrap.min.css" rel="stylesheet">
	</head>
	<body>
		<div class="container" >
			<div class="row">
				<h1><%title%></h1>
			</div>
			<div class="row" style=" white-space: pre-wrap; font-family: monospace;">
				var Victim = new mongoose.Schema({
				  id_KTP: { type: String, default: "12345678901234567"},
				  name 	: { type: String, default: "Daniar Heri"},
				  phone	: {type: [{type: String}], default: [] },
				  address	: { type: String, default: "Jl Ngrandu No 8"},
				  original_village: { type: String, default: "Kendalrejo"},
				  gender	: { type: String, default: "L"},
				  birthday	: { type: Date, default: Date.now},
				  status	: { type: String, default: "affected"},
				  is_pregnant : { type: Boolean, default: false},
				  is_deceased : { 
				  	status		: { type: Boolean, default: false},
				  	name_heirs	: { type: [{ type: String}], default: []}
				  },
				  is_major_injury	: { 
				  	status		: { type: Boolean, default: false},
    				date_end  : { type: Date, default: null},
				  	record_medical_facilities	: { type: [{
				  		date_enter: { type: Date, default: Date.now},
				  		id_medical_facility :{ type: mongoose.Schema.Types.ObjectId, ref: 'MedicalFacility' }	
				  	}], default: []}
				  },
				  is_refugee	: { 
				  	status		: { type: Boolean, default: false},
    				date_end  : { type: Date, default: null},
				  	record_refugee_camps	: { type: [{
				  		date_enter: { type: Date, default: Date.now},
				  		id_refugee_camp :{ type: mongoose.Schema.Types.ObjectId, ref: 'RefugeeCamp' }	
				  	}], default: []}
				  }
				})
			</div>


			<div ng-app="myApp">
				<div ng-controller="disasterEventController">
					<form class="form-horizontal" ng-submit="insertDisasterEvent()">
					    <div class="row">
					       <div class="form-group">
					        <label class="col-sm-2">Id KTP</label>
					        <div class="col-sm-10"><input type="number" ng-model="id_KTP" 
					        name="id_KTP" placeholder="id KTP of the victim" class="form-control" required /></div>
					        </div>
					   	</div>
					    <div class="row">
					       <div class="form-group">
					        <label class="col-sm-2">Name</label>
					        <div class="col-sm-10"><input type="text" ng-model="name" 
					        name="name" placeholder="name of the victim" class="form-control" required /></div>
					        </div>
					   	</div>
					    <div class="row">
					       <div class="form-group">
					        <label class="col-sm-2">Phone</label>
						        <div class="col-sm-10">

						        	<span ng-repeat="id in phone_numbers track by $index" style="float:left ">
							            <input type="button" value="{{id}}" class="btn-info" ng-click="processForm($index)" />
				       					<input type="button" value="X" class="btn-danger" style="margin:0 20px 20px -5px" ng-click="deletePhone($index)"/>
							        </span>
							        <div class="row col-md-12">
						        	<span  style="float:left ">
						        		<input type="text" ng-model="phone" name="phone" placeholder="victim's phone number" class="form-control" maxlength="13" required style="    display: inline-block; width: inherit;" />
		       							<input type="button" value="Save" class="btn-success" ng-click="addNewPhone(phone)"/>
						        	</span>
						        	</div>
					        	</div>
					        </div>
					   	</div>
					    <div class="row">
					       <div class="form-group">
					        <label class="col-sm-2">Address</label>
					        <div class="col-sm-10"><input type="text" ng-model="address" 
					        name="address" placeholder="address of the victim" class="form-control" required /></div>
					        </div>
					   	</div>
					    <div class="row">
					       <div class="form-group">
					        <label class="col-sm-2">Village</label>
					        	<div class="col-sm-10">
						        	<span ng-repeat="village in original_village" style="float:left ">
							            <input type="button" value="{{village}}" class="btn-info" ng-click="processForm($index)"/>
				       					<input type="button" value="X" class="btn-danger" style="margin:0 20px 20px -5px" ng-click="deleteOriginalVillage($index)"/>
							        </span>
							        <div ng-hide="isOriginalVillageFilled">
								        <span style="float:left ">
							       			<input type="button" value="+ Register Village" class="btn-success" ng-click="newTabRegisterVillage()"/>
							       			<br><br>
								        </span>

							        	<input type="text" ng-model="searchString" name="search_query" placeholder="original village of the victim" class="form-control" required />
										<br>        
							            <div class="data-ctrl">
							                <span ng-repeat="i in items | searchFor:searchString">
							                    <p><input type="button" value="+" class="btn-success"  ng-click="addOriginalVillage($index)"/> {{i.title}}
							                </span>
							            </div>
							        </div>
						        </div>

					        </div>
					   	</div>
					   <div class="row">
					       <div class="form-group">
						        <label class="col-sm-2">Gender</label>
						        <div class="col-sm-10">
						        	<bs-dropdown  select-val="selected_status_gender = selectedVal" preselected-item="selected_gender" data-dropdown-data="type_gender">
						        	</bs-dropdown> 
						        </div>
						   	</div>
						</div>

				        <div ng-show="selected_status_gender==2">
				        	<div class="row">
						       	<div class="form-group">
							        <label class="col-sm-2">Pregnant</label>
							        <div class="col-sm-10">
							        	<input type="checkbox" ng-model="is_pregnant">
							        </div>
						        </div>
						   	</div>
						</div>
							<div class="row">
					       <div class="form-group">
						        <label class="col-sm-2">Status</label>
						        <div class="col-sm-10">
						        	<bs-dropdown  select-val="selected_status_injury = selectedVal" preselected-item="selected_status_injury" data-dropdown-data="type_status_injury"></bs-dropdown> 
						        </div>
						   	</div>
						</div>
						<div ng-show="selected_status_injury==5">
				        	<div class="row">
						       	<div class="form-group">
							        <label class="col-sm-2">Name of heirs</label>
							        <div class="col-sm-10">
							        	<span ng-repeat="name in name_heirs" style="float:left ">
								            <input type="button" value="{{name}}" class="btn-info" />
					       					<input type="button" value="X" class="btn-danger" style="margin:0 20px 20px -5px" ng-click="deleteNameHeir($index)"/>
								        </span>

								        <div class="row col-md-12">
								        	<span  style="float:left ">
								        		<input type="text" ng-model="name_heir" name="name_heir" placeholder="victim's heir" class="form-control" maxlength="13" required style="    display: inline-block; width: inherit;" />
				       							<input type="button" value="Save" class="btn-success" ng-click="addNewNameHeir(name_heir)"/>
								        	</span>
							        	</div>

							        </div>
						        </div>
						   	</div>
						</div>

						<div ng-show="selected_status_injury==3">
				        	<div class="row">
						       	<div class="form-group">
							        <label class="col-sm-2">Medical facility</label>
							        <div class="col-sm-10">
							        	<span ng-repeat="id in id_medical_facility" style="float:left ">
								            <input type="button" value="{{id}}" class="btn-info" />
					       					<input type="button" value="X" class="btn-danger" style="margin:0 20px 20px -5px" ng-click="deleteIdMedicalFacility($index)"/>
								        </span>

								        <span style="float:left ">
							       			<input type="button" value="+ Register Medical Facility" class="btn-success" ng-click="newTabRegisterMedicalFacility()"/>
							       			<br><br>
								        </span>

							        	<input type="text" ng-model="searchStringMedicalFacility" name="search_query" placeholder="input name or KTP number to search" class="form-control" required />
										<br>        
							            <div class="data-ctrl">
							                <span ng-repeat="i in items | searchFor:searchStringMedicalFacility">
							                    <p><input type="button" value="+" class="btn-success"  ng-click="addIdMedicalFacility($index)"/> {{i.title}}
							                </span>
							            </div>
							            {{status}}
							        </div>
						        </div>
						   	</div>
						</div>


					  	<input class="btn btn-success" type="submit" id="submit" value="Submit" />
					</form>
				</div><!-- cpontroller -->

			</div><!-- MyApp -->

		</div><!-- Container -->

	</body>
</html>

<script src="../../javascripts/jquery.min.js"></script>
<script src="../../javascripts/angular.min.js"></script>
<script src="../../javascripts/angular_directive.js"></script>
<script src="../../javascripts/angular-ui-router.js"></script>
<script src="../../javascripts/ui-bootstrap-tpls.min.js"></script>
<script>
	$app.controller("disasterEventController", function($scope, $http, $templateRequest, $sce, $compile, $window, $modal, $log){

		$scope.getEnterDate = function (id) {
			$modal.open({
		      templateUrl: '/template/template_get_date.hjs',
		      controller: 'disasterEventController'
		    });
	  };


		$http.get('data.json').success(function(data, status, headers, config) {
		        $scope.items = data.data;
		    }).error(function(data, status, headers, config) {
		        console.log("No data found..");
		});

		$scope.birthday = new Date();
		$scope.original_village=[];
		$scope.phone_numbers=[];
		$scope.name_heirs=[];		
		$scope.selected_gender = 1;
		$scope.is_pregnant = false; /*if the person is man, it should be false by default*/
		$scope.selected_status_injury = 1;
		$scope.isOriginalVillageFilled = false;
		$scope.type_gender = [{
		        id: 1,
		        name: "Man"        
		    }, {
		        id: 2,
		        name: "Woman"        
		    }];
		$scope.type_status_injury = [{
		        id: 1,
		        name: "Affected"        
		    }, {
		        id: 2,
		        name: "Minor injury"        
		    }, {
		        id: 3,
		        name: "Major injury"        
		    }, {
		        id: 4,
		        name: "Missing"        
		    }, {
		        id: 5,
		        name: "Deceased"        
		    }];

		$scope.id_medical_facility = [];

		$scope.newTabRegisterMedicalFacility = function(){
	    	$window.open('/db/medical_facility');
		}
		$scope.addIdMedicalFacility = function(id) {
			$scope.getEnterDate(id);
		    // $scope.id_medical_facility.push(id);
	    };


	    $scope.deleteIdMedicalFacility = function(id) {
	    	$scope.id_medical_facility.splice(id, 1);
	    };

	    $scope.addNewPhone = function(phone) {
	    	if(phone != ''){
		        $scope.phone_numbers.push(phone);
				$scope.phone='';	
	    	}
	    };

	    $scope.deletePhone = function(id) {
	    	$scope.phone_numbers.splice(id, 1);
	    };

	    $scope.addOriginalVillage = function(id) {
		    $scope.original_village.push(id);
			$scope.isOriginalVillageFilled = true;
	    };

	    $scope.deleteOriginalVillage = function(id) {
			$scope.isOriginalVillageFilled = false;
	    	$scope.original_village.splice(id, 1);
	    };
	    $scope.deleteNameHeir =  function(id) {
	    	$scope.name_heirs.splice(id, 1);
		}

	    $scope.addNewNameHeir = function(name) {
	    	if(name != ''){
		        $scope.name_heirs.push(name);
				$scope.name_heir='';	
	    	}
	    };
	    $scope.processForm = function(){
		    alert("Submitting form..");
		}

		
	    $scope.newTabRegisterVillage = function() {
	    	$window.open('/db/village');
	    };

	   
	});

</script>